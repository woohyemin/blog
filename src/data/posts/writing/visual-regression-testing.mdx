---
title: "[UI 테스트] 시각적 회귀 테스트 적용 후기 (with Chromatic)"
date: "2024-11-21 02:25:00"
description: "UI 테스트는 어떤 종류가 있고, 시각적 회귀 테스트를 적용해 본 내용에 대해 알아보자"
categories: ["Test"]
thumbnail: "visual-regression-testing/visual_regression_testing_thumbnail.jpg"
tags: ["UI", "Test"]
activate: true
---

예전 회사에서 진행했던 프로젝트에서 **Chromatic**으로 **시각적 회귀 테스트**를 적용하여 팀에 공유해 본 경험이 있다.

UI 테스트 종류에는 여러가지가 있는데, 그 중에 시각적 회귀 테스트를 선택했던 이유와 장단점을 정리해 보았다.

# UI 테스트를 적용하게 된 배경

- 당시 개발 중이었던 프로젝트는 **Atomic Design Pattern**을 적용하여 UI를 개발하고 있었기 때문에 일부 컴포넌트의 변경 사항이 다른 컴포넌트들에 영향을 줄 확률이 높았다.
- 사람이 모든 사이드 이펙트를 예측하고 직접 눈으로 하나하나 확인하는 것은 시간도 오래 걸리고 놓치는 부분이 생길 가능성이 높다.
- 테스트를 통해 제품의 안정성을 보장하고 싶었다.

# UI 테스트의 종류

## <Emoji>✋</Emoji> 수동 테스트 (Manual Testing)

- 개발자가 컴포넌트의 정확성을 수동으로 확인하여 정확성을 검증하는 방식이다.

## <Emoji>📸</Emoji> 스냅샷 테스트 (Snapshot Testing)

- 컴포넌트나 함수의 출력 결과를 스냅샷 파일로 저장하여 현재 출력 결과와 비교하는 방식이다. 스냅샷 파일은 주로 JSON 형태로 저장한다.
- 렌더링 오류 및 경고를 유발하는 마크업의 변경사항을 파악하는 데 도움이 된다.

## <Emoji>🔩</Emoji> 단위 테스트 (Unit Testing)

- 컴포넌트의 출력이 고정 입력값에서 동일하게 유지되는지를 확인하는 방식이다.
- 컴포넌트의 기능적 품질을 테스트하는데 유용하다.
- 주로 Jest를 사용한다.

## <Emoji>🧐</Emoji> 시각적 회귀 테스트 (Visual Regression Testing)

- 기존 UI를 캡처해놓고 변경된 UI와 비교하는 테스트 방식이다.
- 실제 렌더링 되는 UI가 의도한 대로 보여지는지 테스트할 수 있다.
- Chromatic, Playwright, BackstopJS, Percy, Applitools 등을 사용한다.

# 시각적 회귀 테스트를 선택한 이유

- 일부 컴포넌트의 스타일 변경으로 인한 의도치 않은 UI 이슈를 방지할 수 있는 테스트를 적용하고자 했다.
- 스냅샷 테스트나 단위 테스트는 UI의 디테일한 변경사항을 확인하기엔 적합하지 않다고 판단했다.
- 기존 UI를 캡처해놓은 후 비교하는 시각적 회귀 테스트는 픽셀 단위의 디테일한 변경사항도 확인할 수 있다.

# Chromatic을 이용한 테스트의 장단점

Chromatic에서 테스트 자동화를 쉽게 구현할 수 있도록 제공되고 있었고, Storybook으로 컴포넌트를 개발하고 있었기에 호환성이 높을 것 같은 Chromatic으로 적용해 보았다.

## <Emoji>👍</Emoji> 장점

- 시각적 회귀 테스트를 통해 픽셀 단위의 변경 사항도 발견할 수 있어서 **UI가 깨지거나 미세하게 변경되는 현상을 최대한 방지**할 수 있다.
- Chromatic에서 지원하는 **Github PR 자동화 기능**을 활용하면 더 편리하게 사용할 수 있다.
- UI 변경 사항들이 기록되어서 **히스토리 관리**에 도움이 된다.
- 기존에는 다른 팀원의 코드 리뷰 시, UI 변경사항을 PR에서 코드로만 확인하다 보니 실제로 어떻게 렌더링 되는지 확인할 수 없는 아쉬움이 있었는데 **직관적으로 UI를 확인하고 리뷰**할 수 있다는 장점이 있다.
  (팀원의 branch 또는 repository를 실행하여 확인하는 방법이 있긴 하지만.. 코드 리뷰 때마다 그런 방법으로 확인하기엔 꽤 번거롭다...<Emoji>🙄</Emoji>)

## <Emoji>👎</Emoji> 단점

- **자주 사용되는 컴포넌트가 변경되는 경우에는 대부분의 화면이 이전 화면과 다르다고 감지**되어 결국 거의 모든 화면을 확인해야 하는 상황이 생길 수도 있다.
- 하지만 다른 컴포넌트의 **변경사항이 화면에 줄 수 있는 영향을 확인할 수 있다는 점에서 동시에 장점**이 될 수도 있다고 생각한다. (시각적 회귀 테스트를 사용하는 이유이기도 하다.)
- 5,000 스냅샷 초과 또는 Firefox, Safari 등의 환경 같은 **더 많은 기능을 이용하려면 유료**로 사용해야 한다.

<DescriptionBox
  icon="💡"
  title="Diff 기능"
  content="Diff 기능을 활성화하면 UI의 변경사항을 녹색으로 표시해 준다."
/>

![Github repository 정보 입력 캡처 이미지](/images/posts/visual-regression-testing/chromatic_ui_test_result.png)

<Caption content="버튼의 크기가 달라졌을 뿐인데 하단의 텍스트들이 모두 변경된 것처럼 보여진다." />

# 결론

Chromatic을 활용한 시각적 회귀 테스트는 꽤 편리하고 유용하다고 생각된다.

하지만 무료 플랜의 경우 기능이 제한적이라는 점이 아쉬웠기 때문에, 다음에 또 시각적 회귀 테스트를 적용해 볼 기회가 있다면 Playwright나 BackstopJS 같은 도구를 사용해봐도 좋을 것 같다.
